(()=>{"use strict";var t={},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,r),a.exports}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.rv=()=>"1.6.7",r.ruid="bundler=rspack@1.6.7";let n=t=>{let e=t.getContext("webgl2");if(!e)throw Error("inmyu gl2");return e},a=t=>{let e=t.getContext("2d");if(!e)throw Error("inmyu ctx");return e},s=(t,e,r)=>{let i=t.getUniformLocation(e,r);if(!i)throw Error("inarigahaittenai");return i};class o{initialize(){this.parent.type="file",this.parent.addEventListener("input",()=>{var t;let e=null==(t=this.parent.files)?void 0:t.item(0);e?this.callback(e):alert("please select valid video file inmustonikisugiinn")})}bind_callback(t){this.callbacks.push(t)}callback(t){for(let e of this.callbacks)e(t)}constructor(t){i(this,"parent",document.createElement("input")),i(this,"callbacks",[]),t.appendChild(this.parent),this.initialize()}}class c{initialize(){this.canvas.addEventListener("contextlost",()=>{alert("yjsnpi gl2 lost"),this.gl=n(this.canvas)}),this.canvas.addEventListener("contextrestored",()=>{alert("yjsnpi gl2 restored")}),this.gl_init()}gl_init(){let t=this.gl,e=t.createShader(t.VERTEX_SHADER);if(!e)throw Error("verteeex");t.shaderSource(e,"#version 300 es\r\n\r\nin vec2 coord;\r\nout vec2 vcoord;\r\n\r\nuniform vec2 resolution;\r\nuniform vec4 data;\r\n\r\nvoid main() {\r\n\r\n    vec2 res = resolution * 0.5;\r\n    vec2 render = (data.xy * data.zw + data.zw * 0.5) / res - 1.0;\r\n    vec2 scaling = data.zw * 0.5 / res;\r\n\r\n    vec2 position = vec2(\r\n         coord.x * scaling.x + render.x,\r\n         coord.y * scaling.y - render.y\r\n    );\r\n\r\n    gl_Position = vec4(position, 0.0, 1.0);\r\n    vcoord = coord;\r\n\r\n}"),t.compileShader(e);let r=t.createShader(t.FRAGMENT_SHADER);if(!r)throw Error("fraaaa");t.shaderSource(r,"#version 300 es\r\nprecision highp float;\r\n\r\nin vec2 vcoord;\r\nout vec4 color;\r\n\r\nuniform sampler2D tex;\r\n\r\nconst vec3 bb = vec3(0.0, 0.0, 1.0);\r\n\r\nvoid main() {\r\n\r\n    vec2 position = (vcoord + 1.0) * 0.5;\r\n\r\n    position.y = 1.0 - position.y;\r\n\r\n    vec4 texcolor = texture(tex, position);\r\n\r\n    float len = length(bb - texcolor.rgb);\r\n\r\n    if (len < 0.5) {\r\n        texcolor.a = 0.0;\r\n    }\r\n    //float sum = dot(texcolor.rgb, vec3(0.299, 0.587, 0.114));\r\n\r\n    //color = vec4(vec3(sum), texcolor.a);\r\n    color = texcolor;\r\n\r\n}"),t.compileShader(r);let i=t.createProgram();t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),t.useProgram(i);let n=t.createVertexArray();t.bindVertexArray(n);let a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(0);let o=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,2,3]),t.STATIC_DRAW),this.resolution=s(t,i,"resolution"),this.data=s(t,i,"data"),this.texture=t.createTexture()}async bind_source(t){return new Promise(e=>{let r=URL.createObjectURL(t);this.video.src=r,this.video.onloadedmetadata=()=>{let t=this.video.videoWidth,r=this.video.videoHeight;this.canvas.width=t,this.canvas.height=r;let i=this.gl;i.viewport(0,0,t,r),i.uniform2f(this.resolution,t,r),i.uniform4f(this.data,0,0,t,r),e([t,r])}})}write(){let t=this.gl;return t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.video),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.flush(),this.canvas}constructor(t){i(this,"canvas",new OffscreenCanvas(1,1)),i(this,"gl",n(this.canvas)),i(this,"video",document.createElement("video")),i(this,"resolution",void 0),i(this,"data",void 0),i(this,"texture",void 0),this.video.controls=!0,t.appendChild(this.video),this.initialize()}}new class{initialize(){this.canvas.width=19,this.canvas.height=19,this.canvas.addEventListener("contextlost",()=>{alert("kbtit context lost"),this.ctx=a(this.canvas)}),this.canvas.addEventListener("contextrestored",()=>{alert("kbtit context restored")});let t=e=>{this.render(e),requestAnimationFrame(t)};requestAnimationFrame(t),this.input.bind_callback(async t=>{let[e,r]=await this.bb.bind_source(t);this.canvas.width=e,this.canvas.height=r})}render(t){this.delta_time=t-this.time,this.time=t,this.delta_time>1e3&&console.warn("drop_warn",this.delta_time);let e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);let r=this.bb.write();e.drawImage(r,0,0,this.canvas.width,this.canvas.height)}constructor(t){i(this,"canvas",document.createElement("canvas")),i(this,"ctx",a(this.canvas)),i(this,"bb",void 0),i(this,"delta_time",0),i(this,"time",0),i(this,"input",void 0),t.appendChild(this.canvas),this.bb=new c(t),t.appendChild(document.createElement("br")),this.input=new o(t),this.initialize()}}(document.body)})();
//# sourceMappingURL=client.js.map